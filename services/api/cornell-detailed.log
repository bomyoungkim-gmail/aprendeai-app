
> api@0.0.1 test:integration
> jest --config ./test/jest-integration.config.js --testPathPattern=cornell.spec --verbose

FAIL test/integration/cornell.spec.ts (5.415 s)
  Cornell Notes Integration Tests
    GET /contents/:id/cornell - Auto-create
      × should create empty Cornell notes on first GET (19 ms)
      × should return existing Cornell notes on subsequent GET (7 ms)
    PUT /contents/:id/cornell - Save Notes
      × should save main notes (17 ms)
      × should save cue column (6 ms)
      × should save summary text (5 ms)
      × should save all fields together (5 ms)
    Cornell Notes Persistence
      × should persist changes across GET requests (3 ms)
      × should update existing notes without losing data (3 ms)
    Cornell Notes Validation
      × should reject invalid mainNotes format (4 ms)
      × should allow empty cornell notes (3 ms)

  ● Cornell Notes Integration Tests › GET /contents/:id/cornell - Auto-create › should create empty Cornell notes on first GET

    expected 200 "OK", got 401 "Unauthorized"

      75 |         .get(apiUrl(ROUTES.CONTENT.CORNELL(testContentId)))
      76 |         .set('Authorization', authToken)
    > 77 |         .expect(200);
         |          ^
      78 |       
      79 |       expect(response.body).toHaveProperty('id');
      80 |       expect(response.body.contentId).toBe(testContentId);

      at Object.<anonymous> (integration/cornell.spec.ts:77:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › GET /contents/:id/cornell - Auto-create › should return existing Cornell notes on subsequent GET

    expected 200 "OK", got 401 "Unauthorized"

      90 |         .get(apiUrl(ROUTES.CONTENT.CORNELL(testContentId)))
      91 |         .set('Authorization', authToken)
    > 92 |         .expect(200);
         |          ^
      93 |       
      94 |       const createdId = first.body.id;
      95 |       

      at Object.<anonymous> (integration/cornell.spec.ts:92:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save main notes

    expected 200 "OK", got 401 "Unauthorized"

      123 |         .set('Authorization', authToken)
      124 |         .send({ mainNotes })
    > 125 |         .expect(200);
          |          ^
      126 |       
      127 |       expect(response.body.mainNotes).toEqual(mainNotes);
      128 |     });

      at Object.<anonymous> (integration/cornell.spec.ts:125:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save cue column

    expected 200 "OK", got 401 "Unauthorized"

      135 |         .set('Authorization', authToken)
      136 |         .send({ cueColumn })
    > 137 |         .expect(200);
          |          ^
      138 |       
      139 |       expect(response.body.cueColumn).toBe(cueColumn);
      140 |     });

      at Object.<anonymous> (integration/cornell.spec.ts:137:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save summary text

    expected 200 "OK", got 401 "Unauthorized"

      147 |         .set('Authorization', authToken)
      148 |         .send({ summaryText })
    > 149 |         .expect(200);
          |          ^
      150 |       
      151 |       expect(response.body.summaryText).toBe(summaryText);
      152 |     });

      at Object.<anonymous> (integration/cornell.spec.ts:149:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save all fields together

    expected 200 "OK", got 401 "Unauthorized"

      166 |         .set('Authorization', authToken)
      167 |         .send(data)
    > 168 |         .expect(200);
          |          ^
      169 |       
      170 |       expect(response.body.mainNotes).toEqual(data.mainNotes);
      171 |       expect(response.body.cueColumn).toBe(data.cueColumn);

      at Object.<anonymous> (integration/cornell.spec.ts:168:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Persistence › should persist changes across GET requests

    expected 200 "OK", got 401 "Unauthorized"

      186 |         .set('Authorization', authToken)
      187 |         .send(data)
    > 188 |         .expect(200);
          |          ^
      189 |       
      190 |       // Retrieve
      191 |       const response = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:188:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Persistence › should update existing notes without losing data

    expected 200 "OK", got 401 "Unauthorized"

      207 |           summaryText: 'Original summary',
      208 |         })
    > 209 |         .expect(200);
          |          ^
      210 |       
      211 |       // Update only cueColumn
      212 |       const updated = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:209:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Validation › should reject invalid mainNotes format

    expected 400 "Bad Request", got 401 "Unauthorized"

      233 |           mainNotes: 'not an object',  // Should be object
      234 |         })
    > 235 |         .expect(400);
          |          ^
      236 |     });
      237 |     
      238 |     it('should allow empty cornell notes', async () => {

      at Object.<anonymous> (integration/cornell.spec.ts:235:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Validation › should allow empty cornell notes

    expected 200 "OK", got 401 "Unauthorized"

      245 |           summaryText: '',
      246 |         })
    > 247 |         .expect(200);
          |          ^
      248 |       
      249 |       expect(response.body.mainNotes).toEqual({});
      250 |     });

      at Object.<anonymous> (integration/cornell.spec.ts:247:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

Test Suites: 1 failed, 1 total
Tests:       10 failed, 10 total
Snapshots:   0 total
Time:        5.621 s, estimated 8 s
Ran all test suites matching /cornell.spec/i.
