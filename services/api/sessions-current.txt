FAIL test/integration/sessions.spec.ts (7.03 s)
  ● Sessions Integration Tests › POST /contents/:id/sessions - Create Session › should create a new reading session

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.create()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:48:42

      45 
      46 // Setup: Create test content
      47 // Create test content first (we'll update owner after getting user from auth)
    → 48 const content = await prisma.content.create(
    Foreign key constraint violated: `contents_owner_user_id_fkey (index)`

      46 |     // Setup: Create test content
      47 |     // Create test content first (we'll update owner after getting user from auth)
    > 48 |     const content = await prisma.content.create({
         |                     ^
      49 |       data: {
      50 |         ownerUserId: '00000000-0000-0000-0000-000000000000', // Temporary, will update later
      51 |         title: 'Test Content for Integration',

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:48:21)

  ● Sessions Integration Tests › Session Phase Transitions › should advance from PRE to DURING

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.create()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:48:42

      45 
      46 // Setup: Create test content
      47 // Create test content first (we'll update owner after getting user from auth)
    → 48 const content = await prisma.content.create(
    Foreign key constraint violated: `contents_owner_user_id_fkey (index)`

      46 |     // Setup: Create test content
      47 |     // Create test content first (we'll update owner after getting user from auth)
    > 48 |     const content = await prisma.content.create({
         |                     ^
      49 |       data: {
      50 |         ownerUserId: '00000000-0000-0000-0000-000000000000', // Temporary, will update later
      51 |         title: 'Test Content for Integration',

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:48:21)

  ● Sessions Integration Tests › Session Phase Transitions › should reject FINISHED without DoD requirements

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.create()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:48:42

      45 
      46 // Setup: Create test content
      47 // Create test content first (we'll update owner after getting user from auth)
    → 48 const content = await prisma.content.create(
    Foreign key constraint violated: `contents_owner_user_id_fkey (index)`

      46 |     // Setup: Create test content
      47 |     // Create test content first (we'll update owner after getting user from auth)
    > 48 |     const content = await prisma.content.create({
         |                     ^
      49 |       data: {
      50 |         ownerUserId: '00000000-0000-0000-0000-000000000000', // Temporary, will update later
      51 |         title: 'Test Content for Integration',

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:48:21)

  ● Sessions Integration Tests › Session Phase Transitions › should allow FINISHED when all DoD met

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.create()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:48:42

      45 
      46 // Setup: Create test content
      47 // Create test content first (we'll update owner after getting user from auth)
    → 48 const content = await prisma.content.create(
    Foreign key constraint violated: `contents_owner_user_id_fkey (index)`

      46 |     // Setup: Create test content
      47 |     // Create test content first (we'll update owner after getting user from auth)
    > 48 |     const content = await prisma.content.create({
         |                     ^
      49 |       data: {
      50 |         ownerUserId: '00000000-0000-0000-0000-000000000000', // Temporary, will update later
      51 |         title: 'Test Content for Integration',

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:48:21)

  ● Sessions Integration Tests › Session Events › should record quiz response event

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.create()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:48:42

      45 
      46 // Setup: Create test content
      47 // Create test content first (we'll update owner after getting user from auth)
    → 48 const content = await prisma.content.create(
    Foreign key constraint violated: `contents_owner_user_id_fkey (index)`

      46 |     // Setup: Create test content
      47 |     // Create test content first (we'll update owner after getting user from auth)
    > 48 |     const content = await prisma.content.create({
         |                     ^
      49 |       data: {
      50 |         ownerUserId: '00000000-0000-0000-0000-000000000000', // Temporary, will update later
      51 |         title: 'Test Content for Integration',

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:48:21)

  ● Sessions Integration Tests › Session Events › should record production submit event

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.create()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:48:42

      45 
      46 // Setup: Create test content
      47 // Create test content first (we'll update owner after getting user from auth)
    → 48 const content = await prisma.content.create(
    Foreign key constraint violated: `contents_owner_user_id_fkey (index)`

      46 |     // Setup: Create test content
      47 |     // Create test content first (we'll update owner after getting user from auth)
    > 48 |     const content = await prisma.content.create({
         |                     ^
      49 |       data: {
      50 |         ownerUserId: '00000000-0000-0000-0000-000000000000', // Temporary, will update later
      51 |         title: 'Test Content for Integration',

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:48:21)


  ● Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.deleteMany()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\sessions.spec.ts:120:26

      117 await prisma.cornellNote.deleteMany({ where: { userId: testUserId } }); // DELETE BEFORE readingSession!
      118 await prisma.readingSession.deleteMany({ where: { userId: testUserId } });
      119 await prisma.contentChunk.deleteMany({ where: { contentId: testContentId } });
    → 120 await prisma.content.deleteMany(
    Foreign key constraint violated: `content_versions_content_id_fkey (index)`

      118 |     await prisma.readingSession.deleteMany({ where: { userId: testUserId } });
      119 |     await prisma.contentChunk.deleteMany({ where: { contentId: testContentId } });
    > 120 |     await prisma.content.deleteMany({ where: { id: testContentId } });
          |     ^
      121 |     await prisma.learnerProfile.deleteMany({ where: { userId: testUserId } });
      122 |     await prisma.user.deleteMany({ where: { id: testUserId } });
      123 |     

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/sessions.spec.ts:120:5)

Test Suites: 1 failed, 1 total
Tests:       6 failed, 6 total
Snapshots:   0 total
Time:        7.321 s, estimated 9 s
Ran all test suites matching /test\\integration\\sessions.spec.ts/i.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.
