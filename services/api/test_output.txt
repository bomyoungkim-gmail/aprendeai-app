
> api@0.0.1 test
> jest content-mode.controller.spec

  console.log
    Validation Test Status: 400

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:162:15)

  console.log
    Validation Test Body: {
      "message": [
        "mode must be one of the following values: NARRATIVE, DIDACTIC, TECHNICAL, NEWS, SCIENTIFIC, LANGUAGE"
      ],
      "error": "Bad Request",
      "statusCode": 400
    }

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:163:15)

FAIL src/cornell/__tests__/content-mode.controller.spec.ts
  ContentModeController (Integration)
    GET /cornell/contents/:id/mode
      √ should return content mode info successfully (24 ms)
      √ should return 404 when content not found (5 ms)
      √ should return inferred mode when mode is null (4 ms)
    PUT /cornell/contents/:id/mode
      √ should update content mode successfully (15 ms)
      √ should validate DTO - reject invalid mode (21 ms)
      × should validate DTO - reject invalid source (5 ms)
      √ should accept valid mode without source (4 ms)
      √ should return 404 when content not found (4 ms)
      × should reject request without mode field (5 ms)
      √ should reject extra fields in request body (3 ms)
    Authentication
      √ should call JwtAuthGuard for GET endpoint (3 ms)
      √ should call JwtAuthGuard for PUT endpoint (3 ms)

  ● ContentModeController (Integration) › PUT /cornell/contents/:id/mode › should validate DTO - reject invalid source

    expected 400 "Bad Request", got 200 "OK"

      176 |           source: 'INVALID_SOURCE',
      177 |         })
    > 178 |         .expect(400);
          |          ^
      179 |
      180 |       expect(response.body.message).toContain('source');
      181 |     });

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:178:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● ContentModeController (Integration) › PUT /cornell/contents/:id/mode › should reject request without mode field

    expect(received).toContain(expected) // indexOf

    Expected value: "mode"
    Received array: ["mode must be one of the following values: NARRATIVE, DIDACTIC, TECHNICAL, NEWS, SCIENTIFIC, LANGUAGE"]

      223 |         .expect(400);
      224 |
    > 225 |       expect(response.body.message).toContain('mode');
          |                                     ^
      226 |     });
      227 |
      228 |     it('should reject extra fields in request body', async () => {

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:225:37)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 10 passed, 12 total
Snapshots:   0 total
Time:        4.637 s, estimated 7 s
Ran all test suites matching /content-mode.controller.spec/i.
