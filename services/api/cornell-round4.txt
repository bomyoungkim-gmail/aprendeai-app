FAIL test/integration/cornell.spec.ts (7.344 s)
  ● Cornell Notes Integration Tests › GET /contents/:id/cornell - Auto-create › should create empty Cornell notes on first GET

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › GET /contents/:id/cornell - Auto-create › should return existing Cornell notes on subsequent GET

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save notes

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save cues

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save summary text

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › PUT /contents/:id/cornell - Save Notes › should save all fields together

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Persistence › should persist changes across GET requests

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Persistence › should update existing notes without losing data

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Validation › should reject invalid notes_json format

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ● Cornell Notes Integration Tests › Cornell Notes Validation › should allow empty cornell notes

    expected 201 "Created", got 400 "Bad Request"

      48 |         schoolingLevel: 'ADULT',
      49 |       })
    > 50 |       .expect(201);
         |        ^
      51 |
      52 |     // Login (Auth token will belong to THIS user)
      53 |     const loginResponse = await request(app.getHttpServer())

      at Object.<anonymous> (integration/cornell.spec.ts:50:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)


  ● Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.content.deleteMany()` invocation in
    C:\projects\aprendeai-app\services\api\test\integration\cornell.spec.ts:83:26

      80 afterAll(async () => {
      81   // Cleanup
      82   await prisma.cornellNotes.deleteMany({ where: { userId: testUserId } });
    → 83   await prisma.content.deleteMany(
    Foreign key constraint violated: `content_versions_content_id_fkey (index)`

      81 |     // Cleanup
      82 |     await prisma.cornellNotes.deleteMany({ where: { userId: testUserId } });
    > 83 |     await prisma.content.deleteMany({ where: { id: testContentId } });
         |     ^
      84 |     await prisma.user.deleteMany({ where: { id: testUserId } });
      85 |     await app.close();
      86 |   });

      at $n.handleRequestError (../node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (integration/cornell.spec.ts:83:5)

Test Suites: 1 failed, 1 total
Tests:       10 failed, 10 total
Snapshots:   0 total
Time:        7.534 s, estimated 8 s
Ran all test suites matching /test\\integration\\cornell.spec.ts/i.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.
