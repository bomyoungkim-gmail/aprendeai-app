
> api@0.0.1 test
> jest content-mode.controller.spec

  console.log
    Validation Test Status: 400

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:162:15)

  console.log
    Validation Test Body: {
      "message": [
        "mode must be one of the following values: NARRATIVE, DIDACTIC, TECHNICAL, NEWS, SCIENTIFIC, LANGUAGE"
      ],
      "error": "Bad Request",
      "statusCode": 400
    }

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:163:15)

FAIL src/cornell/__tests__/content-mode.controller.spec.ts
  ContentModeController (Integration)
    GET /cornell/contents/:id/mode
      âˆš should return content mode info successfully (23 ms)
      âˆš should return 404 when content not found (5 ms)
      âˆš should return inferred mode when mode is null (3 ms)
    PUT /cornell/contents/:id/mode
      âˆš should update content mode successfully (14 ms)
      âˆš should validate DTO - reject invalid mode (18 ms)
      Ã— should validate DTO - reject invalid source (3 ms)
      âˆš should accept valid mode without source (3 ms)
      âˆš should return 404 when content not found (3 ms)
      Ã— should reject request without mode field (5 ms)
      âˆš should reject extra fields in request body (3 ms)
    Authentication
      âˆš should call JwtAuthGuard for GET endpoint (2 ms)
      âˆš should call JwtAuthGuard for PUT endpoint (3 ms)

  â— ContentModeController (Integration) â€º PUT /cornell/contents/:id/mode â€º should validate DTO - reject invalid source

    expected 400 "Bad Request", got 200 "OK"

    [0m [90m 176 |[39m           source[33m:[39m [32m'INVALID_SOURCE'[39m[33m,[39m
     [90m 177 |[39m         })
    [31m[1m>[22m[39m[90m 178 |[39m         [33m.[39mexpect([35m400[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 179 |[39m
     [90m 180 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'source'[39m)[33m;[39m
     [90m 181 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:178:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  â— ContentModeController (Integration) â€º PUT /cornell/contents/:id/mode â€º should reject request without mode field

    expect(received).toContain(expected) // indexOf

    Expected value: "mode"
    Received array: ["mode must be one of the following values: NARRATIVE, DIDACTIC, TECHNICAL, NEWS, SCIENTIFIC, LANGUAGE"]

    [0m [90m 223 |[39m         [33m.[39mexpect([35m400[39m)[33m;[39m
     [90m 224 |[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'mode'[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 226 |[39m     })[33m;[39m
     [90m 227 |[39m
     [90m 228 |[39m     it([32m'should reject extra fields in request body'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/cornell/__tests__/content-mode.controller.spec.ts:225:37)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 10 passed, 12 total
Snapshots:   0 total
Time:        4.53 s, estimated 5 s
Ran all test suites matching /content-mode.controller.spec/i.
